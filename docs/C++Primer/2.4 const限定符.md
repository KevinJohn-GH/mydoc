# 2.4 const限定符

用关键字**const**对变量类型加以限定的变量不能改变其值。

const对象一旦创建后其值就不能再改变，所以const对象必须初始化。

#### 初始化和const

const对象与非const对象主要区别就是：只能在const的对象上执行不改变其内容的操作。

#### 默认状态下，const对象仅在文件内有效

- 编译器将在编译过程中将用到该变量的地方都换成对应的常量值。
- 默认情况下，const对象被设定为仅在文件内有效。当多个文件中出现了同名的const变量时，其实等同于在不同文件中分别定义了独立的变量。
- 如果想在多个文件之间共享const对象，必须在变量的定义之前添加extern关键字。



## 2.4.1 const的引用

可以把引用绑定到const对象上，就像绑定到其他对象上一样，我们称之为**对常量的引用（reference to const）**

```c++
const int ci = 1024;
const int &r1  = ci;	//引用及其引用对象都是常量。
int &r2 = ci;	//错误：试图让一个非常量引用指向一个常量对象。
```

#### 初始化和对const的引用

引用的类型必须与其所引用对象的类型一致，但是有两个例外，其中之一：

- 在初始化常量引用时允许用任意表达式作为初始值，只要该表达式的结果能转换成引用的类型即可。

```c++
int i = 42;
const int &r1 = i;	//允许将一个const int&绑定到一个普通int对象上
const int &r2 = 42;		//正确：r2是一个常量引用
const int &r3 = r1 * r2;	//正确：r3是一个常量引用	
int & r4 = r1 * 2;		//错误：r4是一个普通的非常量引用
```

#### 对常量的引用可能引用一个并非const的对象

**常量引用仅对引用可参与的操作做出了限定，对于引用的对象本身是否一个常量未作限定**

```c++
int i = 42;
int &r = i;
const int &r1 = i;
r = 0;
r1 = 0;
```



## 2.4.2 指针和const

**指向常量的指针（point to const）** 不能用于改变其所指对象的值。要想存放常量对象的地址，只能使用指向常量的指针：

```c++
const double pi = 3.14;		//pi是个常量，它的值不能改变
double *ptr = &pi;		//错误：ptr是一个普通指针
const double *cptr = &pi;	//正确：cptr可以指向一个双精度常量
*cptr = 42;		//错误：不能给常量pi赋值
```

指针的类型必须与所指向的类型一致，但是有两个例外，其中一种：

- 允许令一个指向常量的指针指向一个非常量对象。

所谓指向常量的指针仅仅要求不能通过该指针改变对象的值，而没有规定那个对象的值不能通过其他途径改变。

#### const 指针

指针是对象，因此就像其他对象类型一样，允许把指针本身定为常量。**常量指针（const pointer）**必须初始化，而且一旦初始化完成，指针的值（也就是指针中存放的地址）就不能再改变了。

```c++
int errNumb = 0;
int *const curErr = &errNumb;	//定义一个指向int类型的常量指针
const double pi = 3.14158;
const double * const pip = &pi;	//pip是一个指向常量double对象的常量指针
```

指针是一个常量不意味这不能通过指针修改所指向的内容。



## 2.4.3 顶层const

**顶层const（top-level const）**表示指针本身是常量。

**底层const（low-level const）**表示指针所指的对象是一个常量。

底层const只与指针和引用等复合类型有关。



## 2.4.4 constexpr和常量表达式

**常量表达式 （const expression）**是指值不会被改变且在编译过程中就能得到计算结果的表达式。

#### constexpr变量

一般来说，如果你认定变量是一个常量表达式，那就将它声明成constexpr类型。

#### 字面值类型

- 算术类型、字面值、指针和引用都属于字面值
- 指针和引用都能定义成constexpr，但是初始值受严格控制。constexpr指针初始值必须是nullptr或者0。
- 函数体内的变量一般不是存放在固定的内存里面，所以一般不能使用constexpr定义。
- 允许在函数内定义有效范围超过函数本身的变量，这种允许使用constexpr定义。

#### 指针和constexpr

 如果在constexpr中声明了一个指针，限定符仅对指针有效，对指针所指的内容无关。